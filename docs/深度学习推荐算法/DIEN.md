# 序列模型——DIEN

> DIEN《[Deep Interest Evolution Network for Click-Through Rate Prediction](https://arxiv.org/pdf/1809.03672v1.pdf)》 的创新在于用序列模型模拟了用户兴趣的进化过程。



## DIEN的进化动力

用户的历史行为是一个随时间排序的序列，存在一定的前后依赖的关系。DIN和AFM模型仅是对不同行为的重要性进行打分，是时间无关的。

用户的兴趣是丰富多样的，且每个兴趣的演变基本互不影响。此外，影响最终行为的仅仅是与目标商品相关的兴趣。所以DIEN仍然采用了attention机制，**捕获与目标商品相关商品的兴趣发展路径**。

**DIEN最大的特点是不但要找到用户的interest，还要抓住用户interest的进化过程。作者们将GRU融合到网络中，从而捕获到变化的sequence**

## 模型结构

模型是输入层+Embedding层+连接层+多层全连接神经网络+输出层的架构。DIEN的创新点在于如何构建兴趣进化网络

兴趣进化网络分为三层：

1. 行为序列层，将用户的行为序列转换为embedding行为序列
2. 兴趣抽取层，模拟用户的兴趣迁移过程，抽取用户兴趣
3. 兴趣进化层，加上注意力机制，模拟与当前目标广告的兴趣进化过程

![DIEN 整体架构](https://blog-1252832257.cos.ap-shanghai.myqcloud.com/3b8753b527684f22a8de23fe89ba1905.png)



### 兴趣抽取层

兴趣抽取层的基本结构是GRU，经过GRU组成的兴趣抽取层用户的行为向量$b(t)$被抽象化，形成了兴趣状态向量$h(t)$。

直接用GRU仍存在一些问题：

1. 隐藏状态$h(t)$ 仅仅只是抓住了用户行为序列的依赖关系并不能有效的反映出用户兴趣.
2. 用户点击的广告商品肯定是反应了用户的兴趣，如果仅靠最后全连接层后的loss，只能学到用户最终综合的兴趣（因为最终综合的兴趣导致用户发生了这一次点击行为），而中间状态$h(t)$无法得到有效的监督信号指导。

DIEN为此增加了一个中间监督（auxiliary loss），

![image-20220801213149720](https://blog-1252832257.cos.ap-shanghai.myqcloud.com/image-20220801213149720.png)

### 兴趣进化层

兴趣进化层的特点是加入了注意力机制，注意力得分是当前状态向量与目标广告向量进行互作用的结果，考虑与目标广告的相关性。

将目标商品的embedding向量与第1个GRU的输出隐向量发生交互，生成attention score

![image-20220801215743483](https://blog-1252832257.cos.ap-shanghai.myqcloud.com/image-20220801215743483.png)

TODO:AUGRU

