# 数据流与特征工程



## 推荐系统的数据流

### 批处理大数据架构

Google的GFS和Apache HDFS为代表的分布式存储系统解决了海量数据的存储问题。

MapReduce框架采用分布式数据处理在逐步Reduce的方法并行处理海量数据。

分布式+Map Reduce的架构只能处理已经落盘的数据，无法在数据采集、传输过程中处理数据，因此被批处理大数据架构

这个架构替换了原来传统数据库依托传统文件系统的方式，数据的延迟大，影响相关应用的实时性。



### 流计算大数据架构

在数据流产生及传递的过程中流式地消费并处理数据。

在每个窗口内，数据被缓存并消费，在完成一个窗口的处理后，在滑动到下个时间窗口进行新一轮的处理，窗口的大小以分钟级居多。



知名的开源流计算平台有Storm、Spark Streaming、**Flink**



在数据合法性检查、数据回放、全量数据分析等应用场景上无法胜任，在时间窗口较短的情况下，日志乱序，join操作造成的数据遗漏会使数据的误差累积



### Lambda架构

两条分支：实时流和离线处理

实时流保持了流计算架构，保障了数据的实时性，离线处理部分以批处理为主，保障了数据的一致性。

在将统计数据存入最终的数据库之前，Lambda架构会对实时流数据和离线层数据进行合并，并会利用离线层数据对实时流数据进行**校验和纠错**。

Lambda是目前大部分公司的主流架构，但实时流和离线处理存在大量逻辑冗余，需要重复的进行编码工作，浪费了大量的资源。



### Kappa架构

Kappa架构一切都以流计算的形式执行。

批处理是一个时间窗口比较大的流处理，也可以使用流处理的计算逻辑，不过不可能在在线环境下通过流处理实现。

Kappa架构在原来流处理框架的基础上加上了两个通路，原始数据存储和数据重播。原始数据存储将未经流处理的数据或者日志原封不动的保存到分布式文件系统中，数据重播将这些原始数据按时间顺序进行重播，并用同样的流处理框架进行处理

Kappa架构实现 Lambda架构流处理部分和离线部分的结合，不过数据回放过程中的效率问题、批处理和流处理操作能否完全共享等难点仍需解决。



### 大数据平台与推荐系统

大数据平台对推荐系统的主要任务：1. 训练数据的处理 2. 特征的预计算

1. 以HDFS为代表的的离线海量数据存储平台，负责存储离线训练用的训练样本
2. 以Redis为代表的的再现实时特征数据库，负责为模型的在线服务提供实时特征

加入了机器学习层的架构也被称为新一代的Unified大数据架构。
